{% extends "layout.html" %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card shadow-lg border-0 mb-4">
            <div class="card-header bg-transparent">
                <h2 class="text-center mb-0">Premium Fidget Key Options</h2>
            </div>
            <div class="card-body">
                <form method="POST" action="/" id="keyForm">
                    <div class="row justify-content-center g-4">
                        {% for key, price in key_data.items() %}
                        <div class="col-lg-4 col-md-6">
                            <div class="key-option">
                                <input type="radio" class="btn-check" name="key" id="{{ key|replace(' ', '_') }}" 
                                       value="{{ key }}" {% if selected_key == key %}checked{% endif %}>
                                <label class="btn btn-outline-primary w-100 h-100 d-flex flex-column key-label" for="{{ key|replace(' ', '_') }}">
                                    <span class="key-name">{{ key }}</span>
                                    <span class="key-price">${{ price }}</span>
                                    <div class="key-image mt-2 mb-2">
                                        {% if "WASD" in key %}
                                        <svg width="60" height="60" viewBox="0 0 100 100" class="key-svg">
                                            <rect x="10" y="40" width="20" height="20" class="key-base" rx="4" />
                                            <rect x="40" y="70" width="20" height="20" class="key-base" rx="4" />
                                            <rect x="70" y="40" width="20" height="20" class="key-base" rx="4" />
                                            <rect x="40" y="10" width="20" height="20" class="key-base" rx="4" />
                                            <text x="15" y="55" fill="white" font-weight="bold" class="key-text">A</text>
                                            <text x="45" y="85" fill="white" font-weight="bold" class="key-text">S</text>
                                            <text x="75" y="55" fill="white" font-weight="bold" class="key-text">D</text>
                                            <text x="45" y="25" fill="white" font-weight="bold" class="key-text">W</text>
                                        </svg>
                                        {% elif "1x1" in key %}
                                        <svg width="60" height="60" viewBox="0 0 100 100" class="key-svg">
                                            <rect x="30" y="30" width="40" height="40" class="key-base" rx="6" />
                                            <text x="45" y="55" fill="white" font-weight="bold" class="key-text">1</text>
                                        </svg>
                                        {% elif "2x1" in key %}
                                        <svg width="60" height="60" viewBox="0 0 100 100" class="key-svg">
                                            <rect x="10" y="30" width="80" height="40" class="key-base" rx="6" />
                                            <line x1="50" y1="30" x2="50" y2="70" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                        </svg>
                                        {% elif "3x1" in key %}
                                        <svg width="60" height="60" viewBox="0 0 100 100" class="key-svg">
                                            <rect x="5" y="30" width="90" height="40" class="key-base" rx="6" />
                                            <line x1="35" y1="30" x2="35" y2="70" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="65" y1="30" x2="65" y2="70" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                        </svg>
                                        {% elif "2x2" in key %}
                                        <svg width="60" height="60" viewBox="0 0 100 100" class="key-svg">
                                            <rect x="20" y="20" width="60" height="60" class="key-base" rx="6" />
                                            <line x1="50" y1="20" x2="50" y2="80" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="20" y1="50" x2="80" y2="50" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                        </svg>
                                        {% elif "3x2" in key %}
                                        <svg width="60" height="60" viewBox="0 0 100 100" class="key-svg">
                                            <rect x="10" y="25" width="80" height="50" class="key-base" rx="6" />
                                            <line x1="37" y1="25" x2="37" y2="75" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="63" y1="25" x2="63" y2="75" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="10" y1="50" x2="90" y2="50" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                        </svg>
                                        {% elif "3x3" in key %}
                                        <svg width="60" height="60" viewBox="0 0 100 100" class="key-svg">
                                            <rect x="15" y="15" width="70" height="70" class="key-base" rx="6" />
                                            <line x1="38" y1="15" x2="38" y2="85" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="62" y1="15" x2="62" y2="85" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="15" y1="38" x2="85" y2="38" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="15" y1="62" x2="85" y2="62" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                        </svg>
                                        {% elif "4x4" in key %}
                                        <svg width="60" height="60" viewBox="0 0 100 100" class="key-svg">
                                            <rect x="10" y="10" width="80" height="80" class="key-base" rx="6" />
                                            <line x1="30" y1="10" x2="30" y2="90" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="50" y1="10" x2="50" y2="90" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="70" y1="10" x2="70" y2="90" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="10" y1="30" x2="90" y2="30" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="10" y1="50" x2="90" y2="50" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                            <line x1="10" y1="70" x2="90" y2="70" stroke="rgba(255,255,255,0.3)" stroke-width="1"/>
                                        </svg>
                                        {% endif %}
                                    </div>
                                    <span class="key-icon">
                                        {% if "WASD" in key %}
                                        <i class="fas fa-gamepad"></i>
                                        {% else %}
                                        <i class="fas fa-keyboard"></i>
                                        {% endif %}
                                    </span>
                                </label>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    
                    <div class="d-grid gap-2 col-md-4 mx-auto mt-4">
                        <button type="submit" class="btn btn-primary btn-lg">
                            Select Option <i class="fas fa-check-circle ms-2"></i>
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        {% if selected_key %}
        <div class="selection-result text-center">
            <div class="alert shadow-sm p-4 animate-fade-in" style="background: rgba(33, 150, 243, 0.15); border: 2px solid var(--fidget-blue-dark); border-radius: 1rem;">
                <h3 class="mb-3">Your Selection</h3>
                <p class="fs-5">You selected: <strong>{{ selected_key }}</strong></p>
                
                <div class="row justify-content-center mt-4 mb-4">
                    <div class="col-md-10">
                        <div class="card customization-options">
                            <div class="card-header bg-transparent">
                                <h4 class="mb-0">Customize Your Fidget Keys</h4>
                            </div>
                            <div class="card-body">
                                <form method="POST" action="/" id="customizeForm" class="customize-form">
                                    <input type="hidden" name="key" value="{{ selected_key }}">
                                    
                                    <div class="row g-4">
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Base Color (+$0.50)</label>
                                                <div class="color-picker-wrapper">
                                                    <select name="base_color" id="baseColor" class="form-select">
                                                        {% for color in color_options %}
                                                        <option value="{{ color }}" 
                                                                {% if base_color == color %}selected{% endif %}
                                                                style="background-color: {{ color }}; color: white;">
                                                            {{ color }}
                                                        </option>
                                                        {% endfor %}
                                                    </select>
                                                    <div class="color-preview" id="baseColorPreview" style="background-color: {{ base_color or '#0066CC' }};"></div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="form-group">
                                                <label class="form-label">Top Color (+$0.50)</label>
                                                <div class="color-picker-wrapper">
                                                    <select name="top_color" id="topColor" class="form-select">
                                                        {% for color in color_options %}
                                                        <option value="{{ color }}" 
                                                                {% if top_color == color %}selected{% endif %}
                                                                style="background-color: {{ color }}; color: white;">
                                                            {{ color }}
                                                        </option>
                                                        {% endfor %}
                                                    </select>
                                                    <div class="color-preview" id="topColorPreview" style="background-color: {{ top_color or '#FFFFFF' }};"></div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="form-check mt-4">
                                        <input class="form-check-input" type="checkbox" name="warranty" id="warranty" {% if warranty %}checked{% endif %}>
                                        <label class="form-check-label" for="warranty">
                                            Add 1-Year Warranty Protection (+$1.00)
                                        </label>
                                    </div>
                                    
                                    <div class="preview-container mt-4">
                                        <h5>Live Preview</h5>
                                        <div class="key-preview" id="keyPreview">
                                            <!-- Preview will be generated via JavaScript -->
                                        </div>
                                    </div>
                                    
                                    <button type="button" id="checkoutButton" class="btn btn-primary mt-4">
                                        Proceed to Checkout
                                    </button>
                                    <!-- No hidden field needed here -->
                                </form>
                                
                                <!-- Checkout Form (Hidden by default) -->
                                <form method="POST" action="/checkout" id="checkoutForm" class="checkout-form" style="display: none;">
                                    <h5 class="mb-4">Complete Your Order</h5>
                                    
                                    <!-- Hidden fields to carry over the configuration -->
                                    <input type="hidden" id="checkout-key" name="product_key">
                                    <input type="hidden" id="checkout-base-color" name="base_color">
                                    <input type="hidden" id="checkout-top-color" name="top_color">
                                    <input type="hidden" id="checkout-warranty" name="warranty">
                                    <input type="hidden" id="checkout-total" name="total_price">
                                    
                                    <div class="mb-3">
                                        <label class="form-label">First Name</label>
                                        <input type="text" class="form-control" name="first_name" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Last Name</label>
                                        <input type="text" class="form-control" name="last_name" required>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Lunch Preference</label>
                                        <select class="form-select" name="lunch" required>
                                            <option value="">Select an option</option>
                                            <option value="A">A</option>
                                            <option value="B">B</option>
                                            <option value="C">C</option>
                                        </select>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label">Email Address</label>
                                        <input type="email" class="form-control" name="email" required>
                                    </div>
                                    
                                    <div class="d-flex justify-content-between mt-4">
                                        <button type="button" id="backToCustomize" class="btn btn-outline-secondary">
                                            Back
                                        </button>
                                        <button type="submit" class="btn btn-primary">
                                            Complete Purchase
                                        </button>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                <p class="fs-4 price-display">Total Price: <span class="badge">${{ value }}</span></p>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
